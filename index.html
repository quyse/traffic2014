<!doctype html>
<html>
	<head>
		<title>Traffic</title>
		<link href="jquery-ui/jquery-ui.min.css" rel="stylesheet">
		<script type="text/javascript" src="jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="jquery-ui/jquery-ui.min.js"></script>
		<script type="text/javascript" src="engine.js"></script>
		<style>
			#canvasContainerContainer {
				position: absolute;
				left: 0;
				top: 0;
				right: 0;
				bottom: 0;
				margin: 0;
				padding: 0;
				overflow: hidden;
				background-color: #000;
			}
			#canvasContainer {
				position: absolute;
				left: 0;
				top: 0;
				margin: 0;
				padding: 0;
				background-color: #fff;
			}
			#canvas {
				margin: 0;
				padding: 0;
			}
			.car {
				position: absolute;
				width: 150px;
				height: 50px;
				transform-origin: 75px 25px;
				background-image: url('art/cars.png');
			}
			.car1 { background-position: 0 0px; }
			.car2 { background-position: 0 50px; }
			.car3 { background-position: 0 100px; }
			.car4 { background-position: 0 150px; }
			.car5 { background-position: 0 200px; }
			.car6 { background-position: 0 250px; }
			.car7 { background-position: 0 300px; }
			.car8 { background-position: 0 350px; }
			.car9 { background-position: 0 400px; }
			.car10 { background-position: 0 450px; }
		</style>
	</head>
	<body>
		<div id="canvasContainerContainer">
			<div id="canvasContainer">
				<canvas id="canvas" width="4096" height="4096"></canvas>
			</div>
		</div>
		<script type="text/javascript">
			var canvasContainer = $('#canvasContainer');
			var canvas = $('#canvas')[0];
			var canvasWidth = canvas.width;
			var canvasHeight = canvas.height;
			var context = canvas.getContext('2d');

			var engine = new Engine(canvas);

			var carTypes = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'];

			$.ajax('map.json', {
				dataType: 'json',
				success: load
			});

			var graph = null;
			var world = null;
			function load(graphData) {
				graph = Engine.Graph.deserialize(graphData);
				graph.updateInOutEdges();

				engine.drawGraph(graph);

				world = new Engine.World(graph, $('#canvasContainer'), carTypes);

				var timestep = 0.01;
				function step() {
					world.process(timestep);
					setTimeout(step, timestep * 1000);
				}
				step();
			}

			$('#canvasContainer').draggable();

		</script>
	</body>
</html>
